@using BrowserFileExtensions = MudBlazor.Extensions.Extensions.BrowserFileExt
@using System.IO
@using MudBlazor.Extensions.Options

@namespace MudBlazor.Extensions.Components
<MudDialog Class="dialog-content-full-height overflow-hidden mud-ex-dialog-initial" ClassContent="full-height">
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Color="Color.Error" Icon="@Icon" Class="mr-3 mb-n1" />
            @MudDialog.Title
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudExFileDisplay HandleContentErrorFunc="@HandleContentErrorFunc" CustomContentErrorMessage="@CustomContentErrorMessage" FileName="@MudDialog?.Title" ContentStream="@ContentStream" ContentType="@ContentType" Url="@Url"></MudExFileDisplay>
    </DialogContent>

</MudDialog>
@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    [Parameter] public string Icon { get; set; }
    [Parameter] public string Url { get; set; }
    [Parameter] public string ContentType { get; set; }
    [Parameter] public Stream ContentStream { get; set; }
    /**
     * A function to handle content error. Return true if you have handled the error and false if you want to show the error message
     * For example you can reset Url here to create a proxy fallback or display own not supported image or what ever.
     * If you reset Url or Data here you need also to reset ContentType
     */
    [Parameter] public Func<MudExFileDisplay, Task<bool>> HandleContentErrorFunc { get; set; }
    [Parameter] public string CustomContentErrorMessage { get; set; }

    public static Task<IDialogReference> Show(IDialogService dialogService, string url, string fileName, string contentType, Action<DialogOptionsEx> options = null) => dialogService.ShowFileDisplayDialog(url, fileName, contentType, options);

    public static Task<IDialogReference> Show(IDialogService dialogService, IBrowserFile browserFile, Action<DialogOptionsEx> options = null) => dialogService.ShowFileDisplayDialog(browserFile, options);

    public static Task<IDialogReference> Show(IDialogService dialogService, Stream stream, string fileName, string contentType, Action<DialogOptionsEx> options = null) => dialogService.ShowFileDisplayDialog(stream, fileName, contentType, options);
    
}
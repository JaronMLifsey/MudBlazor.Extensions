@using System.IO
@namespace MudBlazor.Extensions.Components
@inject Microsoft.Extensions.Localization.IStringLocalizer<MudExFileDisplay> _localizer


<style>
    /* TODO: Remove, but currently CSS Isolation not working in this project and I dont know why */

    .file-display {
        padding: 10px;
        border: 1px dashed var(--mud-palette-primary);
        height: 100%;
        width: 100%;
        border-radius: 5px;
        display: flex;
        align-items: center;
    }

    .file-display-container {
        height: calc(100% - 60px);
    }

    .download-file {
        float: right;
    }


    .file-display ::deep > img:not([data-mimetype='image/svg+xml']) {
        object-fit: scale-down;
    }


    .file-display ::deep > object {
        width: 100%;
    }
    .file-display ::deep > iframe {
        width: 100%;
    }

    .file-display ::deep > audio {
        width: 100%;
        align-self: center;
    }

    .file-display ::deep > * {
        object-position: center;
        margin-left: auto;
        margin-right: auto;
        display: block;
        max-height: 100%;
        align-self: stretch;
        max-width: 100%;
    }

    .file-display:empty {
        background: repeating-linear-gradient(135deg, #ccc, #ccc 10px, #aaa 10px, #aaa 20px);
        opacity: 0.4;
        border-radius: 5px;
        transition-property: opacity;
        transition-duration: 0.6s;
    }

    .file-display:empty:hover {
        opacity: 0.6;
    }


    .file-display ::deep > .file-display-img-box {
        background-size: auto;
        background-repeat: no-repeat;
        background-position: 50% 50%;
        width: 100%;
        height: 100%
    }

    .file-display-error-message {
        color: var(--mud-palette-error);
        font-style: italic;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #content-type-display-error {
        position: absolute;
        bottom: 80px;
        opacity: 0;
        left: 0;
        right: 0;
        margin-left: auto;
        margin-right: auto;
        width: 60%;
        min-width: 300px;
        transform: scale(0.2);
        transition-property: all !important;
    }

    #content-type-display-error.visible {
        opacity: 1;
        transform: scale(1);
        animation: scaleIn 1200ms ease-in-out 1 alternate;
    }

</style>



<BrowserDetect @bind-BrowserInfo="@Info" />

<div class="file-display-container">
    @if (_isZip)
    {
        <MudExFileDisplayZip AllowDownload="@AllowDownload" RootFolderName="@FileName" ContentStream="@ContentStream" Url="@Url"></MudExFileDisplayZip>
    }
    else
    {
        <div class="file-display">
            <MudElement UserAttributes="@renderInfos.attributes" HtmlTag="@renderInfos.tag"/>
        </div>
    }
    <div id="content-type-display-error">
        <MudAlert Class="mud-alert-close-no-flex" Severity="Severity.Error" Variant="Variant.Outlined" ContentAlignment="HorizontalAlignment.Center" ShowCloseIcon="true" CloseIconClicked="CloseContentError">
            <p>
                @_localizer["The content type {0} cannot be displayed without a suitable plugin", ContentType]
            </p>

            @if (PossiblePlugin != null)
            {
                <MudButton HtmlTag="label"
                           Class="w-100 my-4"
                           Variant="Variant.Text"
                           Color="Color.Primary"
                           Size="Size.Small"
                           Href="@PossiblePlugin.Url"
                           Target="_blank"
                           StartIcon="@(Icons.TwoTone.Shop)">
                    @(_localizer["The Plugin '{0}' may be able to help", PossiblePlugin.Name])
                </MudButton>
            }
        </MudAlert>
    </div>
    @if (AllowDownload)
    {
        <div class="download-file">
            <MudTooltip Placement="Placement.Left" Delay="600" Color="Color.Primary" Text="@($"{_localizer["Download"]} ({FileName})")">
                <MudIconButton Style="float: right;" OnClick="@(Download)" Icon="@Icons.Filled.Download"></MudIconButton>
            </MudTooltip>
        </div>
    }
</div>